#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
VENV_DIR="$SCRIPT_DIR/detect-secrets-venv"
INSTALLER="$SCRIPT_DIR/../scripts/install-detect-secrets.sh"

if [ ! -x "$VENV_DIR/bin/detect-secrets" ]; then
  if [ -x "$INSTALLER" ]; then
    "$INSTALLER"
  else
    echo "detect-secrets installer not found at $INSTALLER" >&2
    exit 1
  fi
fi

if [ ! -x "$VENV_DIR/bin/detect-secrets" ]; then
  echo "detect-secrets is not available. Ensure Python 3 is installed and re-run composer install." >&2
  exit 1
fi

exec "$VENV_DIR/bin/detect-secrets" "$@"
